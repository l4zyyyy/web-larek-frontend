# Проектная работа "Веб-ларек" 
 
Стек: HTML, SCSS, TS, Webpack 
 
Структура проекта: 
- src/ — исходные файлы проекта 
- src/components/ — папка с JS компонентами 
- src/components/base/ — папка с базовым кодом 
 
Важные файлы: 
- src/pages/index.html — HTML-файл главной страницы 
- src/types/index.ts — файл с типами 
- src/index.ts — точка входа приложения 
- src/scss/styles.scss — корневой файл стилей 
- src/utils/constants.ts — файл с константами 
- src/utils/utils.ts — файл с утилитами 
 
## Установка и запуск 
Для установки и запуска проекта необходимо выполнить команды 
 
``` 
npm install 
npm run start 
``` 
 
или 
 
``` 
yarn 
yarn start 
``` 
## Сборка 
 
``` 
npm run build 
``` 
 
или 
 
``` 
yarn build 
``` 
 
## Данные и типы данных, используемые в приложении 
 
Карточка товара.  
 
``` 
interface IProduct { 
  id: string; 
  description: string; 
  image: string; 
  title: string; 
  category: string; 
  price: number | null; 
} 
``` 
 
Заказ. 
 
``` 
interface IOrder { 
  payment: string; 
  email: string; 
  phone: string; 
  address: string; 
} 
``` 
 
Данные заказа для отправки на сервер. 
 
``` 
interface IOrderRequest extends IOrder { 
  items: string[]; 
  total: number; 
} 
``` 
Успешный заказ. 
 
``` 
interface IOrderResult { 
  id: string, 
  total: number 
} 
``` 
Модель данных товара. 
 
``` 
interface IProductData { 
  setProductList(items: IProduct[]): void; 
  getProductList(): IProduct[]; 
  getProductById(id: string): IProduct; 
} 
``` 
 
Модель данных заказа. 
 
``` 
interface IOrderData { 
  _basket: TBasketItem[]; 
  _order: Omit<IOrder, 'items' | 'total'>; 
  addProduct(item: TBasketItem): void; 
  deleteProduct(idProduct: string): void; 
  getTotal(): number; 
  getBasket(): TBasketItem[]; 
  setOrder(orderData: Omit<IOrder, 'items' | 'total'>): void; 
} 
``` 
 
Id карточки для просмотра подробной информации 
``` 
type TProductId = Pick<IProduct, 'id'>; 
``` 
Карточки в корзине. 
``` 
type TBasketItem = Pick<IProduct, 'id' | 'title' | 'price'>; 
``` 
Данные в форме оплата. 
``` 
type TOrderPayment  = Pick<IOrder, 'payment' | 'address'> 
``` 
Данные в форме котакты. 
``` 
type TOrderContacts  = Pick<IOrder, 'email' | 'phone'> 
``` 
Ошибки в формах. 
``` 
type FormErrors = Partial<Record<keyof IOrder, string>>; 
``` 
## Архитектура приложения 
 
Код приложения разделен на слои согласно парадигме MVP:  
- слой View(представления), отвечает за отображение данных на странице,  
- слой Model(данные), отвечает за хранение и изменение данных 
- Presenter(презентер), связывает данные и представление. 
 
### Базовый код 
 
#### Класс Api 
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 
Методы:  
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер 
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове. 
 
#### Класс EventEmitter 
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.   
Основные методы, реализуемые классом описаны интерфейсом `IEvents`: 
- `on` - подписка на событие 
- `emit` - инициализация события 
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 
 
#### Класс Component 
Содержит в себе методы для работы с DOM-элементами. Класс наследуют все классы представления.  
- `toggleClass` - удаление/добавления класса DOM-элементу 
- `setText` - установить текстовое содержимое 
- `setDisabled` - включение/отключение кнопки 
- `setHidden` - устанавливает DOM-элементу CSS-свойство display в значение 'none' 
- `setVisible` - удаляет CSS-свойство display у элемента 
- `setImage` - устанавливает элементу Image значения атрибута src и alt 
- `render` - отрисовка DOM-элементов  
 
### Слой данных 
 
#### Класс ProductData 
Класс отвечает за хранение и логику работы с данными карточек товара.\ 
Конструктор класса принимает инстант брокера событий\ 
В полях класса хранятся следующие данные: 
- `productList: IProduct[]` - массив объектов карточек товара. 
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных. 
 
Так же класс предоставляет набор методов для взаимодействия с этими данными. 
- `setProductList(productData: IProduct): IProductList`  - устанавливает массив объектов с карточками.   
- `getProductList(): IProduct[]` - получает массив объектов с карточками. 
- `getProductById(id: string): IProduct` - получает объект карточки товара по id. 
 
#### Класс OrderData 
Класс отвечает за хранение и логику работы с данными заказа.\ 
Конструктор класса принимает инстант брокера событий\ 
В полях класса хранятся следующие данные: 
- `_basket: TBasketItem[]` - товары в корзине 
- `_order: IOrder` - данные заказа 
- `formErrors` - ошибки при валидации 
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных. 
 
Так же класс предоставляет набор методов для взаимодействия с этими данными. 
- `addProduct(product: TBasketItem): void` - добавляет товар в корзину и заказ. 
- `deleteProduct(idProduct: string): void` - удаляет товар из корзины и заказа. 
- `getTotal()` - получить стоимость заказа 
- `updateTotal()` - обновить стоимость заказа 
- `clearDataForms()` - очистить заказа из форм 
- `clearBasket()` - очистить корзину  
- `setOrderField(field: keyof Pick<IOrder, 'payment' | 'address'>, value: string): void` - получить поля и данные введенные данные формы заказа 
- `setContact(field: keyof Pick<IOrder, 'email' | 'phone'>, value: string): void` - получить поля и данные введенные данные формы контактов 
- `validateContacts()` - проверка на валидность полей формы контактов 
- `validateOrder()` - проверка на валидность полей формы заказа 
 
### Классы представления 
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных. 
 
#### Базовый Класс Component 
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.
 
#### Класс Modal 
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.   
- `constructor(container: HTMLElement, events: IEvents)` Конструктор принимает `container`, в котором будет разметка содержимого модального окна и экземпляр класса `EventEmitter` для возможности инициации событий. 
 
Поля класса 
- `container: HTMLElement` - родительский контейнер, в который вставляется весь DOM модального окна.
- `content: HTMLElement` - элемент, предназначенный для динамического контента модального окна. 
- `events: IEvents` - брокер событий 
 
#### Класс ProductCard 
Расширяет класс Component. Предназначен для реализации карточек товара на главной странице. 
- `constructor(container: HTMLElement, events: IEvents)` Конструктор принимает `container`, в котором будет разметка содержимого модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.\ 
Поля класса: 
- `itemId: string` - id товара 
- `_category: HTMLElement`- элемент карточки категория 
- `_title: HTMLElement`- элемент карточки заголовок 
- `_image: HTMLImageElement`- элемент карточки изображение 
- `_price: HTMLElement` - элемент карточки цена 
- `openButton: HTMLButtonElement`- элемент карточки кнопка для открытия карточки 
 
#### Класс ProductCardPreview 
Расширяет класс ProductCard. При открытии модального окна отображает подробную информацию о товаре и кнопку добавления в корзину или удаления из нее.Предоставляет методы для управления активностью кнопки купить/удалить из корзины. 
- `constructor(container: HTMLElement, events: IEvents)` - 
конструктор принимает `container`, в котором будет разметка содержимого модального окна и экземпляр класса `EventEmitter` для возможности инициации событий. 
 
Поля класса:  
- `protected _description: HTMLElement`- элемент карточки описание  
- `protected button: HTMLButtonElement` - кнопка купить/удалить из корзины 
 
Методы: 
- `buttonStatus(isInBasket: boolean)` - изменение текста на кнопке в зависимости товар в корзине или нет. 
- `buttonDisabled(priceless: boolean)` - отключение кнопки, если товар бесценен 
 
#### Класс Basket 
Расширяет класс Component. Предназначен для реализации модального окна корзина. Отображает список товаров с название и ценой, а так же общей суммой. 
- `constructor(container: HTMLElement, events: IEvents)` - 
конструктор принимает `container`, в котором будет разметка содержимого модального окна и экземпляр класса `EventEmitter` для возможности инициации событий. 
 
Поля класса: 
- `_list: HTMLElement` - список товаров  
- `orderButton: HTMLButtonElement` - кнопка формления заказа 
- `_totalPrice: HTMLElement` - общая цена товаров в корзине 
 
#### Класс BasketItem
Предназначен для отображения одного товара внутри корзины.
- `constructor(item: TBasketItem, index: number, events: IEvents)` -
конструктор принимает объект товара (TBasketItem), порядковый номер этого товара в корзине и экземпляр EventEmitter для проброса событий.

Поля класса:
- `_item: TBasketItem` - данные о товаре
- `_index: number` - порядковый номер товара в списке
- `_events: IEvents` - объект событий
- `_element: HTMLElement` - DOM-элемент карточки товара
- `_title: HTMLElement` - заголовок карточки (название товара)
- `_price: HTMLElement` - цена товара
- `_deleteButton: HTMLButtonElement` - кнопка удаления товара
- `_itemIndex: HTMLElement` - отображение порядкового номера

Методы:
- `render(): HTMLElement` - возвращает разметку карточки товара для вставки в корзину.

#### Класс Page 
Расширяет класс Component. Предназначен для реализации главной страницы с карточками товара и иконкой корзины.\ 
- `constructor(container: HTMLElement, events: IEvents)` - 
конструктор принимает `container`, в котором будет разметка содержимого главной страницы и экземпляр класса `EventEmitter` для возможности инициации событий. 
Поля класса: 
- `elementCounter: HTMLElement` - счетчик количества товара в корзине 
- `buttonBasket: HTMLButtonElement` - кнопка корзины 
- `galleryCard: HTMLElement` - галерея карточек товара 
 
Методы: 
- `setLocked(value: boolean)` - блокирует страницу во время открытия модального окна 
 
#### Класс Form 
Расширяет класс Component. Реализует форму. Иницилизирует событие, оповещающее об изменении полей. Отправляет данные в модель, по нажатию кнопки sumbit. Изменяте состояние кнопки sumbit, в зависимости от валидности полей. 
 
Поля класса: 
- `_submit: HTMLButtonElement` - кнопка отправки данных формы 
- `_errors: HTMLElement` - элемент, в котором отображаются ошибки при не валидности полей 
 
Методы: 
- `onInputChange(field: keyof T, value: string)` - защещенной метод. Инициализирует событие, при котором передаются данный поля и введенных в него данных. 
 
#### Класс FormOrder 
Расширяет класс Form. Реализует форму заказа. Устанавливает значение полей. Сбрасывает содержимое полей, при закрытии модального окна. 
 
Поля класса: 
- `paymentButtons: NodeListOf<HTMLButtonElement>` - кнопки выбора способа оплаты. 
- `selectedPayment: string` - переменная, хранящая выбранный метод оплаты. 
 
Методы: 
- `reset()` - сброс введенных данных формы. 
 
#### Класс FormContacts 
 
Расширяет класс Form. Реализует форму контактов. Класс отвечает за установку данных полей и сброс (reset) формы при закрытии. 
 
Поля класса: 
- `emailField: HTMLInputElement` - поле ввода email. 
- `phoneField: HTMLInputElement` - поле ввода телефона. 
- `formErrors: Record<string, string>` - ошибки валидации полей формы. 
 
Методы: 
- `setFieldValue(field: keyof TFormContacts, value: string): void` - установка значения конкретного поля. 
- `reset(): void` - сброс всех полей формы и ошибок валидации. 
- `validate(): boolean` - проверка корректности полей формы. 
 
#### Класс FormSuccess 
 
Оповещение об успешном оформление заказа и вывод общей суммы заказа. 
 
Поля класса: 
- `messageContainer: HTMLElement` -контейнер для текста уведомления. 
- `totalContainer: HTMLElement` - элемент для отображения суммы заказа. 
 
Методы: 
- `show(total: number): void` - отображает уведомление с общей суммой заказа. 
- `hide(): void` - скрывает уведомление. 
 
### Слой коммуникации 
 
#### Класс LarekApi 
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса. 
 
## Взаимодействие компонентов 
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\ 
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\ 
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий. 
 
*Список всех событий, которые могут генерироваться в системе:*\ 
*События изменения данных (генерируются классами моделями данных)* 
- `productList:changed` - изменение списка карточек товара 
- `formErrorsOrder:change` - изменение состояния валидации формы заказа 
- `formErrorsContacts:change` - изменение состояния валидации формы контактов 
- `/^order\..*:change/` - изменение одного из полей формы заказа 
- `/^contacts\..*:change/` - изменение одного из полей формы контактов 
- `totalUpdated` - обновление суммы заказа 
- `order:ready` - поля формы заказа валидны 
- `contacts:ready` - поля формы контактов валидны 
 
*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)* 
- `modal:open` - открытие модального окна 
- `modal:close` - закрытие модального окна  
- `basket:open` - открытие модального окна с корзиной 
- `product:open` - открытие модального окна с товаром 
- `product:addBasket` - добавление товара в корзину 
- `product:removeBasket` - удаление товара из корзины 
- `basket:submit` - добавление товаров из корзины в заказ 
- `order:submit` - добавление данных способа оплаты и адреса в заказ 
